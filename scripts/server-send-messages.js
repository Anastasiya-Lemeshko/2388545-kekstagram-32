var N=/^#[a-zа-яё0-9]{1,19}$/i,R=/\s+/g;var s={none:{name:"none",style:" ",min:0,max:100,step:1,unit:""},chrome:{name:"chrome",style:"grayscale",min:0,max:1,step:.1,unit:""},sepia:{name:"sepia",style:"sepia",min:0,max:1,step:.1,unit:""},marvin:{name:"marvin",style:"invert",min:0,max:100,step:1,unit:"%"},phobos:{name:"phobos",style:"blur",min:0,max:3,step:.1,unit:"px"},heat:{name:"heat",style:"brightness",min:1,max:3,step:.1,unit:""}},P="https://32.javascript.htmlacademy.pro/kekstagram",I={GET_DATA:"/data",SEND_DATA:"/"},y={IDLE:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C",SENDING:"\u041F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u044F..."};var c=e=>e.key==="Escape",H=e=>e.key==="Enter";var L=document.querySelector(".img-upload__form"),f=L.querySelector(".text__hashtags"),U=L.querySelector(".text__description"),m=new Pristine(L,{classTo:"img-upload__field-wrapper",errorTextParent:"img-upload__field-wrapper",errorTextClass:"img-upload__field-error"}),v=e=>e.length?f.value.toLowerCase().replaceAll(R," ").trim().split(" "):[],ge=e=>v(e).every(o=>N.test(o)),ye=e=>{let t=v(e),o=[...new Set(t)];return t.length===o.length},Le=e=>v(e).length<=5;m.addValidator(f,ge,"\u0425\u044D\u0448\u0442\u0435\u0433 \u0441\u043E\u0441\u0442\u043E\u0438\u0442 \u0438\u0437 \u0431\u0443\u043A\u0432 \u0438 \u0446\u0438\u0444\u0440, \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u0430\u044F \u0434\u043B\u0438\u043D\u0430 20 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432",1,!0);m.addValidator(f,ye,"\u0425\u044D\u0448\u0442\u0435\u0433\u0438 \u043D\u0435 \u043C\u043E\u0433\u0443\u0442 \u043F\u043E\u0432\u0442\u043E\u0440\u044F\u0442\u044C\u0441\u044F",2,!0);m.addValidator(f,Le,"\u0420\u0430\u0437\u0440\u0435\u0448\u0435\u043D\u043E \u043D\u0435 \u0431\u043E\u043B\u0435\u0435 \u043F\u044F\u0442\u0438 \u0445\u044D\u0448\u0442\u0435\u0433\u043E\u0432",3,!0);var ve=()=>U.value.length<=140;m.addValidator(U,ve,`\u0414\u043B\u0438\u043D\u0430 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0442\u044C ${140} \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432`);var B=()=>m.validate(),$=()=>{m.reset()};var h=document.querySelector(".img-upload__preview-container"),z=h.querySelector(".scale__control--smaller"),W=h.querySelector(".scale__control--bigger"),X=h.querySelector(".scale__control--value"),Te=h.querySelector(".img-upload__preview img"),i=parseInt(X.value,10),j=()=>{z.disabled=i<=25,W.disabled=i>=100},A=e=>{X.value=`${e}%`,Te.style.transform=`scale(${e/100})`};z.addEventListener("click",()=>{i>25&&(i-=25,A(i),j())});W.addEventListener("click",()=>{i<100&&(i+=25,A(i),j())});var Y=()=>{A(100)};var d=document.querySelector(".img-upload__wrapper"),T=d.querySelector(".img-upload__preview img"),qe=d.querySelector(".effects__list"),Q=d.querySelector(".img-upload__effect-level"),E=d.querySelector(".effect-level__slider"),J=d.querySelector(".effect-level__value"),xe=Object.keys(s).map(e=>s[e]),Z=({style:e,max:t,unit:o})=>{T.style.filter="",T.style.filter=`${e}(${t}${o})`},q=()=>{Q.classList.add("hidden")},Ce=()=>{Q.classList.remove("hidden")},we=()=>{let e=d.querySelector(".effects__radio:checked").value;J.value=E.noUiSlider.get(),T.style.filter=`${s[e].style}(${J.value}${s[e].unit})`},ee=({max:e,min:t,step:o})=>{noUiSlider.create(E,{range:{min:t,max:e},start:e,step:o,connect:"lower",format:{to:r=>Number(r),from:r=>Number(r)}}),E.noUiSlider.on("update",we),q()},De=({min:e,max:t,step:o})=>{E.noUiSlider.updateOptions({range:{min:e,max:t},start:t,step:o})};qe.addEventListener("change",e=>{let t=xe.find(o=>o.name===e.target.value);Z(t),De(t),e.target.value!=="none"?Ce():q()});var te=()=>{Z(s.none),q()};var st=document.querySelector("#data-error").content.querySelector(".data-error");var a=document.querySelector(".big-picture"),oe=a.querySelector(".big-picture__img img"),Fe=a.querySelector(".likes-count"),Ne=a.querySelector(".social__caption"),Re=a.querySelector(".social__comment-shown-count"),Pe=a.querySelector(".social__comment-total-count"),re=a.querySelector(".social__comments"),x=a.querySelector(".comments-loader"),C=[],g=0,ne=0,Ie=({avatar:e,message:t,name:o})=>{let r=document.createElement("li");r.classList.add("social__comment"),r.innerHTML='<img class="social__picture"><p class="social__text"></p>';let n=r.querySelector(".social__picture");n.src=e.replace("img/","images/"),n.alt=o,n.width=35,n.height=35;let S=r.querySelector(".social__text");return S.textContent=t,r},He=()=>{g<ne?x.classList.remove("hidden"):x.classList.add("hidden")},Oe=()=>{Re.textContent=g},se=()=>{let e=document.createDocumentFragment();C.splice(0,5).forEach(t=>{e.append(Ie(t)),g++}),re.append(e),He(),Oe()},ce=({likes:e,comments:t,url:o,description:r})=>{oe.src=`images/${o}`,oe.alt=r,Fe.textContent=e,Ne.textContent=r,Pe.textContent=t.length,C.length=0,g=0,C.push(...t.slice()),re.innerHTML="",ne=t.length,se()};x.addEventListener("click",se);var w=document.querySelector(".big-picture"),ie=w.querySelector(".cancel"),ae=e=>{w.classList.remove("hidden"),document.body.classList.add("modal-open"),document.addEventListener("keydown",le),ce(e)},D=()=>{w.classList.add("hidden"),document.body.classList.remove("modal-open"),document.removeEventListener("keydown",le)};function le(e){c(e)&&(e.preventDefault(),D())}ie.addEventListener("click",()=>{D()});ie.addEventListener("keydown",e=>{H(e)&&D()});var Ue=document.querySelector(".pictures"),pt=document.querySelector("#picture").content.querySelector(".picture"),Be=[];Ue.addEventListener("click",e=>{let t=e.target.closest(".picture");if(t){let o=Number(t.dataset.marker),r=Be.find(n=>n.id===o);ae(r)}});var u=document.querySelector(".img-filters"),At=u.querySelector(".img-filters__form"),Tt=u.querySelector("#filter-default"),qt=u.querySelector("#filter-random"),xt=u.querySelector("#filter-discussed");var $e=e=>{u.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),e.classList.add("img-filters__button--active")};u.addEventListener("click",e=>{e.target.classList.contains("img-filters__button")&&$e(e.target)});var me=e=>fetch(`${P}${I.SEND_DATA}`,{method:"POST",body:e});var l=document.querySelector(".img-upload__form"),de=l.querySelector(".img-upload__input"),ue=l.querySelector(".img-upload__overlay"),Ve=l.querySelector(".img-upload__cancel"),Ge=l.querySelector(".text__hashtags"),Ke=l.querySelector(".text__description"),ze=()=>{ue.classList.remove("hidden"),document.body.classList.add("modal-open"),document.addEventListener("keydown",_)},M=()=>{ue.classList.add("hidden"),document.body.classList.remove("modal-open"),de.value="",document.removeEventListener("keydown",_),$(),Y(),te(),l.reset()};de.addEventListener("change",()=>{ze()});Ve.addEventListener("click",()=>{M()});function _(e){c(e)&&(e.preventDefault(),M())}Ge.addEventListener("keydown",e=>{c(e)&&e.stopPropagation()});Ke.addEventListener("keydown",e=>{c(e)&&e.stopPropagation()});l.addEventListener("submit",e=>{if(e.preventDefault(),B()){k();let t=new FormData(e.target);me(t).then(o=>{if(!o.ok)throw new Error;M(),_e()}).catch(()=>pe()).finally(()=>{k(!1)})}});ee(s.none);var Se=document.querySelector(".img-upload__submit"),We=document.querySelector("#error").content.querySelector(".error"),b=We.cloneNode(!0),Xe=document.querySelector("#success").content.querySelector(".success"),F=Xe.cloneNode(!0),fe=(e,t,o)=>{document.removeEventListener("keydown",_),document.addEventListener("keydown",n),document.addEventListener("click",S);let r=()=>{e.remove(),document.removeEventListener("click",S),document.removeEventListener("keydown",n),e.classList.contains("error")&&document.addEventListener("keydown",_),t.removeEventListener("click",r)};function n(p){c(p)&&(p.preventDefault(),r())}function S(p){let he=p.target.closest(o);p.target!==he&&r()}t.addEventListener("click",r)},pe=()=>{document.body.appendChild(b);let e=b.querySelector(".error__button");fe(b,e,".error__inner")},_e=()=>{document.body.appendChild(F);let e=F.querySelector(".success__button");fe(F,e,".success__inner")},k=(e=!0)=>{Se.disabled=e,Se.textContent=e?y.SENDING:y.IDLE};export{k as blockSubmitButton,pe as showErrorMessage,_e as showSuccessMessage};
