var u="https://32.javascript.htmlacademy.pro/kekstagram",d={GET_DATA:"/data",SEND_DATA:"/"};var f=5e3,y=10,g=500;var O=document.querySelector("#data-error").content.querySelector(".data-error"),A=()=>{let t=O.cloneNode(!0);document.body.appendChild(t),setTimeout(()=>{t.remove()},f)};var w=(t,e)=>{let r=Math.ceil(Math.min(t,e)),o=Math.floor(Math.max(t,e)),n=Math.random()*(o-r+1)+r;return Math.floor(n)},T=t=>t[w(0,t.length-1)],x=t=>t.key==="Escape",L=t=>t.key==="Enter",C=(t,e=500)=>{let r;return(...o)=>{clearTimeout(r),r=setTimeout(()=>t.apply(void 0,o),e)}};var s=document.querySelector(".big-picture"),D=s.querySelector(".big-picture__img img"),$=s.querySelector(".likes-count"),z=s.querySelector(".social__caption"),W=s.querySelector(".social__comment-shown-count"),K=s.querySelector(".social__comment-total-count"),q=s.querySelector(".social__comments"),p=s.querySelector(".comments-loader"),_=[],a=0,R=0,V=({avatar:t,message:e,name:r})=>{let o=document.createElement("li");o.classList.add("social__comment"),o.innerHTML='<img class="social__picture"><p class="social__text"></p>';let n=o.querySelector(".social__picture");n.src=t.replace("img/","images/"),n.alt=r,n.width=35,n.height=35;let i=o.querySelector(".social__text");return i.textContent=e,o},X=()=>{a<R?p.classList.remove("hidden"):p.classList.add("hidden")},j=()=>{W.textContent=a},M=()=>{let t=document.createDocumentFragment();_.splice(0,5).forEach(e=>{t.append(V(e)),a++}),q.append(t),X(),j()},N=({likes:t,comments:e,url:r,description:o})=>{D.src=`images/${r}`,D.alt=o,$.textContent=t,z.textContent=o,K.textContent=e.length,_.length=0,a=0,_.push(...e.slice()),q.innerHTML="",R=e.length,M()};p.addEventListener("click",M);var E=document.querySelector(".big-picture"),v=E.querySelector(".cancel"),k=t=>{E.classList.remove("hidden"),document.body.classList.add("modal-open"),document.addEventListener("keydown",P),N(t)},h=()=>{E.classList.add("hidden"),document.body.classList.remove("modal-open"),document.removeEventListener("keydown",P)};function P(t){x(t)&&(t.preventDefault(),h())}v.addEventListener("click",()=>{h()});v.addEventListener("keydown",t=>{L(t)&&h()});var F=document.querySelector(".pictures"),Y=document.querySelector("#picture").content.querySelector(".picture"),S=[],J=()=>{document.querySelectorAll(".picture").forEach(t=>t.remove())},l=t=>{J(),S.length=0,S.push(...t.slice());let e=document.createDocumentFragment();t.forEach(({id:r,url:o,description:n,likes:i,comments:I})=>{let m=Y.cloneNode(!0);m.querySelector(".picture__img").src=`images/${o}`,m.querySelector(".picture__img").alt=n,m.querySelector(".picture__likes").textContent=i,m.querySelector(".picture__comments").textContent=I.length,m.dataset.marker=r,e.appendChild(m)}),F.append(e)};F.addEventListener("click",t=>{let e=t.target.closest(".picture");if(e){let r=Number(e.dataset.marker),o=S.find(n=>n.id===r);k(o)}});var c=document.querySelector(".img-filters"),Q=c.querySelector(".img-filters__form"),Z=c.querySelector("#filter-default"),tt=c.querySelector("#filter-random"),et=c.querySelector("#filter-discussed"),b=()=>{c.classList.remove("img-filters--inactive")},ot=t=>{c.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),t.classList.add("img-filters__button--active")},nt=t=>{l(t)},rt=t=>{let e=[];for(;e.length!==y;){let r=T(t);e.includes(r)||e.push(r)}l(e)},st=t=>{let o=t.map(n=>({id:n.id,comments:n.comments.length})).sort((n,i)=>n.comments>i.comments?-1:n.comments<i.comments?1:0).map(n=>t[n.id]);l(o)},H=t=>{Q.addEventListener("click",C(e=>{e.target===Z&&nt(t),e.target===tt&&rt(t),e.target===et&&st(t)},g))};c.addEventListener("click",t=>{t.target.classList.contains("img-filters__button")&&ot(t.target)});var Lt=t=>{fetch(`${u}${d.GET_DATA}`).then(e=>{if(!e.ok)throw new Error;return e.json()}).then(e=>{t(e),b(),H(e)}).catch(()=>A())},Ct=t=>fetch(`${u}${d.SEND_DATA}`,{method:"POST",body:t});export{Lt as getData,Ct as sendForm};
